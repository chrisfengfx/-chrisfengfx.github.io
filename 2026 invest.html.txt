<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´¢å¯Œè“å›¾ 2026 | ä¸“ä¸šæŠ•èµ„æ¨¡æ‹Ÿå¹³å°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+SC:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #10b981;
            --primary-dark: #059669;
            --bg-slate: #f8fafc;
        }
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            background-color: var(--bg-slate);
            color: #1e293b;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.04);
        }
        .btn-gradient {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            transition: all 0.3s ease;
        }
        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px -4px rgba(16, 185, 129, 0.4);
        }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body class="antialiased">
    <div class="min-h-screen pb-20">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <nav class="sticky top-0 z-50 bg-white/70 backdrop-blur-md border-b border-slate-200 px-6 py-4">
            <div class="max-w-7xl mx-auto flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 btn-gradient rounded-lg flex items-center justify-center text-white font-black italic">W</div>
                    <span class="font-extrabold text-xl tracking-tight text-slate-800">WealthBlueprint <span class="text-emerald-500">2026</span></span>
                </div>
                <div class="flex items-center gap-4">
                    <div id="statusBadge" class="hidden md:flex items-center gap-2 px-3 py-1 bg-emerald-50 text-emerald-600 rounded-full text-xs font-bold">
                        <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span> äº‘ç«¯å·²åŒæ­¥
                    </div>
                    <button onclick="publishToCloud()" class="btn-gradient text-white px-5 py-2 rounded-xl text-sm font-bold flex items-center gap-2 shadow-lg">
                        <span>ğŸš€</span> å‘å¸ƒå¹¶åˆ†äº«
                    </button>
                </div>
            </div>
        </nav>

        <main class="max-w-7xl mx-auto px-6 mt-8 space-y-8">
            <!-- æ ‡é¢˜åŒºåŸŸ -->
            <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
                <div>
                    <input id="planTitle" type="text" value="æˆ‘çš„ç§äººè´¢å¯Œå¢é•¿æ–¹æ¡ˆ" class="bg-transparent text-3xl md:text-4xl font-black text-slate-900 focus:outline-none border-b-2 border-transparent focus:border-emerald-500 w-full md:w-[500px] transition-all" spellcheck="false">
                    <p class="text-slate-400 font-medium mt-2 flex items-center gap-2">
                        <span>ğŸ“ˆ</span> åŸºäºå¤åˆ©å¼•æ“è®¡ç®—çš„æ¨¡å‹æ–¹æ¡ˆ
                    </p>
                </div>
                <div id="shareInfo" class="hidden animate-in fade-in slide-in-from-right-4">
                    <div class="bg-white p-2 rounded-2xl border border-emerald-100 flex items-center gap-3">
                        <div class="text-[10px] uppercase font-bold text-emerald-500 px-2">æ–¹æ¡ˆ ID</div>
                        <code id="displayId" class="font-mono font-bold text-slate-700 bg-slate-50 px-3 py-1 rounded-lg">--------</code>
                        <button onclick="copyCurrentLink()" class="bg-emerald-50 text-emerald-600 p-2 rounded-lg hover:bg-emerald-100">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" /></svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- æ•°æ®æ¦‚è§ˆ -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="glass-card p-6 rounded-3xl border-b-4 border-b-slate-400">
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">åˆå§‹æŠ•å…¥é‡‘é¢</label>
                    <div class="flex items-baseline gap-1 mt-1">
                        <span class="text-xl font-bold text-slate-400">$</span>
                        <input id="initCap" type="number" value="5000" oninput="calculate()" class="text-3xl font-black bg-transparent w-full focus:outline-none">
                    </div>
                </div>
                <div class="glass-card p-6 rounded-3xl border-b-4 border-b-emerald-500">
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">æ¯æœˆè®¡åˆ’å®šæŠ•</label>
                    <div class="flex items-baseline gap-1 mt-1">
                        <span class="text-xl font-bold text-emerald-400">$</span>
                        <input id="monthlyAdd" type="number" value="300" oninput="calculate()" class="text-3xl font-black bg-transparent w-full focus:outline-none text-emerald-600">
                    </div>
                </div>
                <div class="glass-card p-6 rounded-3xl border-b-4 border-b-amber-500">
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">ç»„åˆé¢„æœŸå›æŠ¥</label>
                    <div class="flex items-baseline gap-1 mt-1">
                        <span id="cagrDisplay" class="text-3xl font-black text-amber-600">0.0</span>
                        <span class="text-sm font-bold text-amber-500">%</span>
                    </div>
                </div>
                <div class="glass-card p-6 rounded-3xl border-b-4 border-b-slate-800 bg-slate-900 text-white">
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">20å¹´åä¼°å€¼</label>
                    <div class="flex items-baseline gap-1 mt-1">
                        <span class="text-xl font-bold text-slate-500">$</span>
                        <span id="futureVal" class="text-3xl font-black">0</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <!-- å·¦ä¾§ï¼šèµ„äº§ç¼–è¾‘ -->
                <div class="lg:col-span-7 space-y-6">
                    <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100">
                        <div class="flex justify-between items-center mb-8">
                            <h3 class="font-extrabold text-xl text-slate-800">èµ„äº§é…æ¯”è¯¦æƒ…</h3>
                            <button onclick="addAsset()" class="bg-slate-50 hover:bg-slate-100 text-slate-600 px-4 py-2 rounded-xl text-xs font-bold transition-all">
                                + æ·»åŠ æ–°ç±»åˆ«
                            </button>
                        </div>
                        <div id="assetList" class="space-y-4">
                            <!-- JS åŠ¨æ€æ³¨å…¥ -->
                        </div>
                        <div id="allocWarning" class="hidden mt-6 p-4 bg-red-50 text-red-500 rounded-2xl text-xs font-bold flex items-center gap-2">
                            âš ï¸ æ³¨æ„ï¼šå½“å‰æ€»å æ¯”ä¸ç­‰äº 100%ï¼Œè¯·è°ƒæ•´ä»¥è·å¾—å‡†ç¡®é¢„æµ‹ã€‚
                        </div>
                    </div>

                    <div class="bg-slate-900 rounded-[2rem] p-8 text-white relative overflow-hidden">
                        <div class="relative z-10">
                            <h3 class="text-xl font-bold">å¤åˆ©å°è´´å£«</h3>
                            <p id="tipText" class="text-slate-400 mt-2 text-sm leading-relaxed">
                                æ­£åœ¨è®¡ç®—æ‚¨çš„æ–¹æ¡ˆåŠ¨æ€å»ºè®®...
                            </p>
                        </div>
                        <div class="absolute -right-10 -bottom-10 w-40 h-40 bg-emerald-500/10 rounded-full blur-3xl"></div>
                    </div>
                </div>

                <!-- å³ä¾§ï¼šå¯è§†åŒ– -->
                <div class="lg:col-span-5 space-y-6">
                    <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100">
                        <h4 class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-6">æŒä»“åˆ†å¸ƒå›¾</h4>
                        <div class="h-[250px]"><canvas id="pieChart"></canvas></div>
                    </div>
                    <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100">
                        <div class="flex justify-between items-center mb-6">
                            <h4 class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">è´¢å¯Œå¢é•¿è·¯å¾„</h4>
                            <select id="yearSelect" onchange="calculate()" class="text-xs font-bold bg-slate-50 border-none rounded-lg px-2 py-1 outline-none">
                                <option value="10">10å¹´æœŸ</option>
                                <option value="20" selected>20å¹´æœŸ</option>
                                <option value="30">30å¹´æœŸ</option>
                            </select>
                        </div>
                        <div class="h-[250px]"><canvas id="lineChart"></canvas></div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="max-w-7xl mx-auto px-6 mt-12 text-center text-slate-400 text-[10px] uppercase tracking-[0.2em]">
            WealthBlueprint Portfolio System Â© 2026 | ä¸“ä¸šé‡‘èæ¨¡æ‹Ÿï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®
        </footer>
    </div>

    <!-- Firebase è„šæœ¬ (ç”¨äºçœŸå®å‘å¸ƒ) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // è·å–ç¯å¢ƒå˜é‡ (ç”±ç³»ç»Ÿæ³¨å…¥)
        const firebaseConfig = JSON.parse(window.__firebase_config || '{}');
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const appId = window.__app_id || 'invest-portal-default';

        window.publishToCloud = async function() {
            const id = Math.random().toString(36).substring(2, 10);
            const data = {
                title: document.getElementById('planTitle').value,
                init: document.getElementById('initCap').value,
                monthly: document.getElementById('monthlyAdd').value,
                assets: window.assets,
                years: document.getElementById('yearSelect').value
            };

            try {
                const path = `/artifacts/${appId}/public/data/invest_plans/${id}`;
                // æ³¨æ„ï¼šç”±äºåœ¨ç¦»çº¿ HTML ä¸­å¯èƒ½æ²¡æœ‰ Auth ç¯å¢ƒï¼Œ
                // å»ºè®®åœ¨çœŸå®éƒ¨ç½²æ—¶é…åˆ Firebase Auth ä½¿ç”¨ã€‚
                // æ­¤å¤„æ¨¡æ‹Ÿé€»è¾‘
                alert("ç”±äºæ‚¨åœ¨æœ¬åœ°æ‰“å¼€ï¼Œäº‘ç«¯åŠŸèƒ½éœ€éƒ¨ç½²åˆ°æœåŠ¡å™¨ã€‚å·²ä¸ºæ‚¨ç”Ÿæˆæœ¬åœ°é…ç½® ID: " + id);
                document.getElementById('shareInfo').classList.remove('hidden');
                document.getElementById('displayId').innerText = id;
            } catch(e) {
                console.error(e);
            }
        }

        window.copyCurrentLink = function() {
            const id = document.getElementById('displayId').innerText;
            const url = window.location.href.split('?')[0] + "?id=" + id;
            const el = document.createElement('textarea');
            el.value = url;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            alert("é“¾æ¥å·²å¤åˆ¶ï¼Œéƒ¨ç½²åå³å¯é€šè¿‡æ­¤é“¾æ¥è®¿é—®ã€‚");
        }
    </script>

    <script>
        // æ ¸å¿ƒé€»è¾‘
        let assets = [
            { name: "æ ‡æ™®500 (VFV)", alloc: 50, ret: 10, color: "#10b981" },
            { name: "çº³æ–¯è¾¾å…‹ (XQQ)", alloc: 20, ret: 13, color: "#3b82f6" },
            { name: "åŠ è‚¡çº¢åˆ© (VDY)", alloc: 30, ret: 7, color: "#f59e0b" }
        ];
        window.assets = assets;

        const palette = ["#10b981", "#3b82f6", "#f59e0b", "#8b5cf6", "#ef4444", "#06b6d4", "#f43f5e"];
        let pieChart, lineChart;

        function init() {
            renderAssets();
            const ctxPie = document.getElementById('pieChart').getContext('2d');
            pieChart = new Chart(ctxPie, {
                type: 'doughnut',
                data: { labels: [], datasets: [{ data: [], backgroundColor: [], borderWidth: 5, borderColor: '#fff' }] },
                options: { 
                    maintainAspectRatio: false, 
                    cutout: '70%',
                    plugins: { legend: { position: 'bottom', labels: { boxWidth: 8, font: { weight: 'bold', size: 10 } } } } 
                }
            });

            const ctxLine = document.getElementById('lineChart').getContext('2d');
            lineChart = new Chart(ctxLine, {
                type: 'line',
                data: { labels: [], datasets: [{ label: 'è´¢å¯Œæ€»å€¼', data: [], borderColor: '#10b981', backgroundColor: 'rgba(16, 185, 129, 0.05)', fill: true, tension: 0.4, pointRadius: 0 }] },
                options: { 
                    maintainAspectRatio: false, 
                    plugins: { legend: { display: false } },
                    scales: { 
                        y: { display: false },
                        x: { grid: { display: false }, ticks: { font: { size: 10 } } }
                    }
                }
            });

            calculate();
        }

        function renderAssets() {
            const list = document.getElementById('assetList');
            list.innerHTML = '';
            assets.forEach((a, i) => {
                const div = document.createElement('div');
                div.className = "flex items-center gap-4 bg-slate-50 p-4 rounded-2xl group transition-all hover:bg-white hover:shadow-md border border-transparent hover:border-slate-100";
                div.innerHTML = `
                    <div class="w-4 h-4 rounded-full" style="background:${a.color}"></div>
                    <input type="text" value="${a.name}" oninput="assets[${i}].name=this.value; calculate()" class="bg-transparent font-bold text-sm text-slate-700 focus:outline-none flex-1">
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] font-bold text-slate-400">å æ¯”</span>
                        <input type="number" value="${a.alloc}" oninput="assets[${i}].alloc=parseFloat(this.value)||0; calculate()" class="w-12 text-right font-black text-slate-800 bg-transparent focus:outline-none">%
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] font-bold text-slate-400">å›æŠ¥</span>
                        <input type="number" value="${a.ret}" oninput="assets[${i}].ret=parseFloat(this.value)||0; calculate()" class="w-12 text-right font-black text-emerald-600 bg-transparent focus:outline-none">%
                    </div>
                    <button onclick="removeAsset(${i})" class="text-slate-300 hover:text-red-400 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                    </button>
                `;
                list.appendChild(div);
            });
        }

        function addAsset() {
            assets.push({ name: "æ–°èµ„äº§ç±»åˆ«", alloc: 0, ret: 8, color: palette[assets.length % palette.length] });
            renderAssets();
            calculate();
        }

        function removeAsset(i) {
            if(assets.length > 1) {
                assets.splice(i, 1);
                renderAssets();
                calculate();
            }
        }

        function calculate() {
            const init = parseFloat(document.getElementById('initCap').value) || 0;
            const monthly = parseFloat(document.getElementById('monthlyAdd').value) || 0;
            const years = parseInt(document.getElementById('yearSelect').value);
            
            let totalAlloc = 0;
            let weightedRet = 0;
            assets.forEach(a => {
                totalAlloc += a.alloc;
                weightedRet += (a.alloc * a.ret);
            });

            document.getElementById('allocWarning').style.display = Math.abs(totalAlloc - 100) > 0.1 ? 'flex' : 'none';
            const cagr = totalAlloc > 0 ? (weightedRet / totalAlloc) : 0;
            document.getElementById('cagrDisplay').innerText = cagr.toFixed(1);

            // å¤åˆ©è®¡ç®—
            let current = init;
            let labels = [];
            let data = [];
            const monthlyRet = (cagr / 100) / 12;

            for(let m=0; m <= years * 12; m++) {
                current = (current + monthly) * (1 + monthlyRet);
                if(m % 12 === 0) {
                    labels.push(m/12 + 'å¹´');
                    data.push(current);
                }
            }

            document.getElementById('futureVal').innerText = Math.round(current).toLocaleString();
            
            // æ›´æ–°åŠ¨æ€è´´å£«
            updateTips(cagr, current, init + monthly * 12 * years);

            // æ›´æ–°å›¾è¡¨
            pieChart.data.labels = assets.map(a => a.name);
            pieChart.data.datasets[0].data = assets.map(a => a.alloc);
            pieChart.data.datasets[0].backgroundColor = assets.map(a => a.color);
            pieChart.update();

            lineChart.data.labels = labels;
            lineChart.data.datasets[0].data = data;
            lineChart.update();
        }

        function updateTips(cagr, final, principal) {
            const profit = final - principal;
            const ratio = profit / principal;
            let text = "";
            if(cagr > 12) text = "ğŸ”¥ æ‚¨çš„æŠ•èµ„ç»„åˆéå¸¸æ¿€è¿›ï¼Œé¢„æœŸå›æŠ¥æé«˜ï¼Œä½†è¯·æ³¨æ„æ³¢åŠ¨é£é™©ã€‚";
            else if(cagr > 8) text = "âœ… è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥åº·çš„æˆé•¿å‹ç»„åˆï¼Œé•¿æœŸæŒæœ‰å°†äº§ç”Ÿå·¨å¤§çš„å¤åˆ©æ•ˆåº”ã€‚";
            else text = "ğŸ›¡ï¸ ç»„åˆé£æ ¼ç¨³å¥ã€‚è€ƒè™‘å¢åŠ  10% çš„æŒ‡æ•°åŸºé‡‘ä»¥æå‡é•¿æœŸè´­ä¹°åŠ›ã€‚";
            
            if(ratio > 1) text += ` ä»¤äººæƒŠå¹çš„æ˜¯ï¼Œå±Šæ—¶æ‚¨çš„æ”¶ç›Šå°†æ˜¯æœ¬é‡‘çš„ ${(ratio).toFixed(1)} å€ï¼`;
            document.getElementById('tipText').innerText = text;
        }

        window.onload = init;
    </script>
</body>
</html>